{% extends 'base.html' %}

{% block title %}Edit Discussion{% endblock %}

{% block content %}
<div class="mb-4">
    <a href="{% url 'threads:thread_detail' pk=thread.pk order_by='-created_at' %}" class="btn btn-white border shadow-sm px-3 py-1 text-muted fw-bold small rounded-pill">
        <i class="bi bi-arrow-left me-1"></i> Cancel
    </a>
</div>

<div class="widget-box p-5 border-0 shadow-sm">
    <div class="mb-4 pb-4 border-bottom">
        <h1 class="fw-bold h3 text-dark mb-1">Edit Discussion</h1>
        <p class="text-secondary mb-0">Update your thread details below.</p>
    </div>

    <form method="post">
        {% csrf_token %}

        {% if form.errors %}
        <div class="alert alert-danger border-0 rounded-3 mb-4 p-3 bg-danger bg-opacity-10 text-danger">
            <div class="fw-bold mb-1"><i class="bi bi-exclamation-triangle-fill me-2"></i>Please fix the errors below:</div>
            <ul class="mb-0 small ps-4">
                {% for field in form %}
                    {% for error in field.errors %}<li>{{ field.label }}: {{ error }}</li>{% endfor %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="mb-4">
            <label class="sidebar-label text-dark mb-2" for="{{ form.title.id_for_label }}">Title</label>
            {{ form.title }}
        </div>

        <div class="mb-4">
            <label class="sidebar-label text-dark mb-2" for="{{ form.raw_content.id_for_label }}">Content</label>
            {{ form.raw_content }}
            <div class="form-text mt-2 text-end text-muted small">Markdown is supported</div>
        </div>

        <div class="mb-5">
            <label class="sidebar-label text-dark mb-2" for="{{ form.tags.id_for_label }}">Topics</label>
            {{ form.tags }}
            <div class="form-text text-muted small">Remove items by clicking the 'x'. Type to search.</div>
        </div>

        <div class="d-flex justify-content-end gap-3">
            <button type="submit" class="btn btn-dark fw-bold px-5 py-2" style="border-radius: var(--radius-sharp);">Save Changes</button>
        </div>
    </form>
</div>

<style>
    /* Force style the default Django widgets since we aren't using a custom form class here */
    #id_title, #id_raw_content {
        display: block;
        width: 100%;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #212529;
        background-color: #FAFAFA;
        background-clip: padding-box;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sharp);
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    #id_raw_content { min-height: 250px; }
    
    #id_title:focus, #id_raw_content:focus {
        background-color: #fff;
        border-color: #000;
        outline: 0;
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
    }
</style>

<link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        if(document.getElementById('id_tags')) {
            new TomSelect("#id_tags", {
                plugins: ['remove_button'],
                maxItems: 5,
                placeholder: "Select or search topics...",
                create: false, 
            });
        }
    });
</script>
{% endblock %}

{% block right_sidebar %}
<div class="mb-4">
    <label class="sidebar-label">Tips</label>
    <div class="widget-box p-4 bg-white">
        <p class="text-muted small mb-0">
            Updating the title or tags will help more people find your discussion. 
            Ensure your content stays relevant to the category.
        </p>
    </div>
</div>
{% endblock %}